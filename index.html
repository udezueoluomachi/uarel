<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAREL</title>
    <link rel="icon" sizes="16x16" href="./images/favicon.png">
    <link rel="stylesheet" href="./style/index.css">
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</head>
<body>
    <div class="main-cont flex flex-x-y-c">
        <div class="section-1">
            <img src="./images/logo.png" alt="UAREL">
        </div>
        <h1 class="intro-text">
            Get Simple URLs in Seconds
        </h1>
        <form action="#" class="index-form">
            <input type="text" id="url-input" class="input" placeholder="Type or paste URL">
            <br/>
            <button class="input" type="submit">Generate</button>
        </form>
    </div>
    <script>
        const $ = e => document.querySelector(e);
        const urlInput = $("#url-input");
        const genBtn = $("button.input");

        genBtn.addEventListener("click", () => {
            genBtn.innerText = "...";
            genBtn.disabled = true;
            let dataToServer = urlInput.value.trim();

            function reset() {
                urlInput.value = "";
                genBtn.innerText = "Generate";
                genBtn.disabled = false;
            }

            function request() {
                fetch("http://localhost:4000/", {
                    method : "POST",
                    body : dataToServer
                })
                .then(data => data.json())
                .then(res => {
                    let url = "https://github.com/udezueoluomachi/uarel";//change this to the response url
                    swal("Generated", url, {
                        icon : "success",
                        buttons: {
                            cancel : "close",
                            confirm : {
                                text : "copy",
                                value : true,
                                closeModal : false
                            }
                        }
                    })
                    .then(val => {
                        reset();
                        navigator.clipboard.writeText(url)
                        swal({
                            title : "Copied!"
                        })
                    })
                })
                .catch(err => {
                    swal({
                        title : "An error occured",
                        icon : "error",
                        buttons : {
                            cancel : "close",
                            retry : {
                                text : "retry",
                                closeModal : false
                            }
                        }
                    })
                    .then(val => {
                        if(val) {
                            request();
                        }
                        else {
                            reset();
                        }
                    })
                })
            }
            request();
        })
    </script>
</body>
</html>